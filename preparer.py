import numpy as np
import pandas as pd
import attr_map


def get_data(dataset_path, encoding):
    df = pd.read_csv(dataset_path)

    attributes = attr_map.ATTR_MAP[encoding]['attrs']
    cat_attributes = attr_map.ATTR_MAP[encoding]['cat_attrs']
    target = attr_map.TARGET

    dropped_columns = np.setdiff1d(df.columns, attributes + [target])
    df = df.drop(dropped_columns, axis=1)

    # Convert to string & lowercase categorical attributes for encoding
    df[cat_attributes] = df[cat_attributes].fillna('temporary_nan_string')
    df[cat_attributes] = df[cat_attributes].astype(str)
    df[cat_attributes] = df[cat_attributes].apply(lambda x: x.str.lower())
    df[cat_attributes] = df[cat_attributes].replace('temporary_nan_string',
                                                    np.nan)

    return df
